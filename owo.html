<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OWO Specification</title>
    <script defer src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/dompurify@latest/dist/purify.min.js"></script>
</head>

<body>
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            await fetchPageContent();
        });


        function loadScript(url, callback) {
            const script = document.createElement("script");
            script.src = url;
            script.onload = callback;
            document.head.appendChild(script);
        }

        async function fetchPageContent() {
            var pathname = window.location.pathname.substring(1);
            if (!pathname) {
                pathname = "index";
            }

            var panel = document.createElement("div");
            const errorMessage = "Could not fetch page content<br><br>O_o";
            try {
                const content = await fetch(`${pathname}.md`, {
                    method: "GET",
                });
                if (content.ok) {
                    const text = await content.text();
                    const parsedMarkdown = await marked.parse(text);
                    const sanitizedMarkdown = DOMPurify.sanitize(parsedMarkdown);
                    panel.innerHTML = sanitizedMarkdown;
                } else {
                    throw new RuntimeException(errorMessage);
                }
            } catch (error) {
                panel.innerHTML = errorMessage;
            }

            document.body.appendChild(panel);
        }
    </script>
    <div id="qr-code" style="margin-top: 20px;"></div>
</body>

</html>