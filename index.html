<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pluribus.me Website Builder</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400italic" rel="stylesheet" type="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@2.31.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@2.8.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@2.7.6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/code@2.9.3"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@1.4.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/table@2.4.5"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@2.7.6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/image@2.10.3"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/paragraph@2.11.7"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/link@2.6.2"></script>
  <script src="netlify-api.js"></script>
  <script src="page-builder.js"></script>
</head>

<body>
  <main id="main-article" class="content-area container-fluid">
    <article id="main" class="panel">
      <header>
        <h1>Pluribus.me Website Builder</h1>
        <button id="convert-markdown-btn" onclick="convertToMarkdown()" class="btn btn-primary"
          style="margin-top: 10px;">
          Convert to Markdown
        </button>
      </header>
    </article>
    <div id="editorjs"></div>
    <button id="makeZip">Create & Save ZIP</button>
  </main>

  <template id="owo-homepage-template">
    <html>

    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>OWO test</title>
    </head>

    <body>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          loadScript("https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js", () => { });
          loadScript("https://cdn.jsdelivr.net/npm/dompurify@latest/dist/purify.min.js", () => { });
          fetchPageContent();
        });

        function loadScript(url, callback) {
          const script = document.createElement("script");
          script.src = url;
          script.onload = callback;
          document.head.appendChild(script);
        }

        async function fetchPageContent() {
          var pathname = window.location.pathname.substring(1);
          if (!pathname) {
            pathname = "index";
          }

          var panel = document.createElement("div");
          const errorMessage = "Could not fetch page content<br><br>O_o";
          try {
            const content = await fetch(`${pathname}.md`, {
              method: "GET",
            });
            if (content.ok) {
              const text = await content.text();
              const parsedMarkdown = await marked.parse(text);
              const sanitizedMarkdown = DOMPurify.sanitize(parsedMarkdown);
              panel.innerHTML = sanitizedMarkdown;
            } else {
              throw new RuntimeException(errorMessage);
            }
          } catch (error) {
            panel.innerHTML = errorMessage;
          }

          document.body.appendChild(panel);
        }
      </script>
    </body>

    </html>
  </template>
</body>

</html>